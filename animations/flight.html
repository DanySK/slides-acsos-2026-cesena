<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <style>
        html,body { margin:0; height:100%; overflow:hidden; background:#111; }
        svg { width:100%; height:100%; display:block; }
        path { fill:none; stroke:#555; stroke-width:0.5; }
        .arc { stroke:#f33; stroke-width:2; }
        .plane { fill:#ff0; stroke:#000; stroke-width:0.5; }
    </style>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/topojson-client@3"></script>
</head>
<body>
<svg></svg>
<script>
    const width = window.innerWidth, height = window.innerHeight;
    const projection = d3.geoNaturalEarth1().scale(width/6.3).translate([width/2,height/2]);
    const path = d3.geoPath(projection);
    const svg = d3.select("svg");

    Promise.all([
        d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json")
    ]).then(([world]) => {
        const countries = topojson.feature(world, world.objects.countries);
        svg.selectAll("path")
            .data(countries.features)
            .enter().append("path")
            .attr("d", path)
            .attr("stroke","#444")
            .attr("fill","#222");

        const tokyo = [139.6917,35.6895];
        const cesena = [12.2466,44.1391];
        const arc = {type:"LineString", coordinates:[tokyo, cesena]};
        const arcPath = svg.append("path")
            .datum(arc)
            .attr("d", path)
            .attr("class","arc");

        const plane = svg.append("circle").attr("r",6).attr("class","plane");

        let t=0;
        function animate() {
            t = (t+0.002) % 1; // speed
            const p = path.pointRadius(0)(arcPath.datum());
            const l = arcPath.node().getTotalLength();
            const pos = arcPath.node().getPointAtLength(t*l);
            plane.attr("cx",pos.x).attr("cy",pos.y);
            requestAnimationFrame(animate);
        }
        animate();
    });
</script>
</body>
</html>
